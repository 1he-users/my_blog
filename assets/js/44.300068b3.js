(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{266:function(t,e,s){"use strict";s.r(e);var i=s(0),r=Object(i.a)({},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),s("p",[t._v("关于"),s("code",[t._v("强缓存")]),t._v("和"),s("code",[t._v("协商缓存")]),t._v("的内容，我已经在"),s("router-link",{attrs:{to:"/perform/001.html"}},[t._v("能不能说一说浏览器缓存")]),t._v("做了详细分析，小结如下:")],1),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),s("p",[t._v("那缓存代理究竟是如何做到的呢？")]),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),s("p",[t._v("讲了这几个字段，我们不妨来举个小例子，源服务器在响应头中加入这样一个字段:")]),t._v(" "),t._m(16),s("p",[t._v("相当于源服务器说: 我这个响应是允许代理服务器缓存的，客户端缓存过期了到代理中拿，并且在客户端的缓存时间为 1000 秒，在代理服务器中的缓存时间为 2000 s。")]),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._m(21),t._v(" "),s("p",[t._v("又比如:")]),t._v(" "),t._m(22),t._m(23),t._v(" "),t._m(24),t._v(" "),t._m(25),t._v(" "),s("p",[t._v("以上便是缓存代理的内容，涉及的字段比较多，希望能好好回顾一下，加深理解。")])])},[function(){var t=this.$createElement,e=this._self._c||t;return e("h1",{attrs:{id:"_013-如何理解-http-缓存及缓存代理？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_013-如何理解-http-缓存及缓存代理？","aria-hidden":"true"}},[this._v("#")]),this._v(" 013: 如何理解 HTTP 缓存及缓存代理？")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("首先通过 "),e("code",[this._v("Cache-Control")]),this._v(" 验证强缓存是否可用")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",[s("li",[t._v("如果强缓存可用，直接使用")]),t._v(" "),s("li",[t._v("否则进入协商缓存，即发送 HTTP 请求，服务器通过请求头中的"),s("code",[t._v("If-Modified-Since")]),t._v("或者"),s("code",[t._v("If-None-Match")]),t._v("这些"),s("strong",[t._v("条件请求")]),t._v("字段检查资源是否更新\n"),s("ul",[s("li",[t._v("若资源更新，返回资源和200状态码")]),t._v(" "),s("li",[t._v("否则，返回304，告诉浏览器直接从缓存获取资源")])])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("这一节我们主要来说说另外一种缓存方式: "),e("strong",[this._v("代理缓存")]),this._v("。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"为什么产生代理缓存？"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#为什么产生代理缓存？","aria-hidden":"true"}},[this._v("#")]),this._v(" 为什么产生代理缓存？")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("对于源服务器来说，它也是有缓存的，比如"),e("strong",[this._v("Redis, Memcache")]),this._v("，但对于 HTTP 缓存来说，如果每次客户端缓存失效都要到源服务器获取，那给源服务器的压力是很大的。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("由此引入了"),e("strong",[this._v("缓存代理")]),this._v("的机制。让"),e("code",[this._v("代理服务器")]),this._v("接管一部分的服务端HTTP缓存，客户端缓存过期后"),e("strong",[this._v("就近")]),this._v("到代理缓存中获取，代理缓存过期了才请求源服务器，这样流量巨大的时候能明显降低源服务器的压力。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("总的来说，缓存代理的控制分为两部分，一部分是"),e("strong",[this._v("源服务器")]),this._v("端的控制，一部分是"),e("strong",[this._v("客户端")]),this._v("的控制。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"源服务器的缓存控制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#源服务器的缓存控制","aria-hidden":"true"}},[this._v("#")]),this._v(" 源服务器的缓存控制")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"private-和-public"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#private-和-public","aria-hidden":"true"}},[this._v("#")]),this._v(" private 和 public")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("在源服务器的响应头中，会加上"),e("code",[this._v("Cache-Control")]),this._v("这个字段进行缓存控制字段，那么它的值当中可以加入"),e("code",[this._v("private")]),this._v("或者"),e("code",[this._v("public")]),this._v("表示是否允许代理服务器缓存，前者禁止，后者为允许。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("比如对于一些非常私密的数据，如果缓存到代理服务器，别人直接访问代理就可以拿到这些数据，是非常危险的，因此对于这些数据一般是不会允许代理服务器进行缓存的，将响应头部的"),e("code",[this._v("Cache-Control")]),this._v("设为"),e("code",[this._v("private")]),this._v("，而不是"),e("code",[this._v("public")]),this._v("。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"proxy-revalidate"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#proxy-revalidate","aria-hidden":"true"}},[this._v("#")]),this._v(" proxy-revalidate")])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("p",[s("code",[t._v("must-revalidate")]),t._v("的意思是"),s("strong",[t._v("客户端")]),t._v("缓存过期就去源服务器获取，而"),s("code",[t._v("proxy-revalidate")]),t._v("则表示"),s("strong",[t._v("代理服务器")]),t._v("的缓存过期后到源服务器获取。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"s-maxage"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#s-maxage","aria-hidden":"true"}},[this._v("#")]),this._v(" s-maxage")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[e("code",[this._v("s")]),this._v("是"),e("code",[this._v("share")]),this._v("的意思，限定了缓存在代理服务器中可以存放多久，和限制客户端缓存时间的"),e("code",[this._v("max-age")]),this._v("并不冲突。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("Cache-Control: public, max-age=1000, s-maxage=2000\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("h2",{attrs:{id:"客户端的缓存控制"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#客户端的缓存控制","aria-hidden":"true"}},[this._v("#")]),this._v(" 客户端的缓存控制")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"max-stale-和-min-fresh"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#max-stale-和-min-fresh","aria-hidden":"true"}},[this._v("#")]),this._v(" max-stale 和 min-fresh")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("在客户端的请求头中，可以加入这两个字段，来对代理服务器上的缓存进行"),e("strong",[this._v("宽容")]),this._v("和"),e("strong",[this._v("限制")]),this._v("操作。比如：")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("max-stale: 5\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("表示客户端到代理服务器上拿缓存的时候，即使代理缓存过期了也不要紧，只要过期时间在"),e("strong",[this._v("5秒之内")]),this._v("，还是可以从代理中获取的。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[this._v("min-fresh: 5\n")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("表示代理缓存需要一定的新鲜度，不要等到缓存刚好到期再拿，一定要在"),e("strong",[this._v("到期前 5 秒")]),this._v("之前的时间拿，否则拿不到。")])},function(){var t=this.$createElement,e=this._self._c||t;return e("h3",{attrs:{id:"only-if-cached"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#only-if-cached","aria-hidden":"true"}},[this._v("#")]),this._v(" only-if-cached")])},function(){var t=this.$createElement,e=this._self._c||t;return e("p",[this._v("这个字段加上后表示客户端只会接受代理缓存，而不会接受源服务器的响应。如果代理缓存无效，则直接返回"),e("code",[this._v("504（Gateway Timeout）")]),this._v("。")])}],!1,null,null,null);e.default=r.exports}}]);